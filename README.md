# 我在校园自动打卡签到脚本
___
## 郑重声明  
1. **本程序仅用作学习交流，不得用于商业用途**
2. **请在国家法律法规和校方相关原则下使用**
3. **开发者不对任何下载者和使用者的任何行为负责**

## 文件说明
* `config.py` 是配置文件，用来填写个人信息
* `save.py` 是健康打卡脚本，根据配置文件中的信息进行健康打卡
* `doSign.py` 是晚签到脚本，位置已经写死（鲜橙大临潼校区）
* `Utils.py` 是工具类
* `mylog.txt` 是用来记录打卡信息的日志文件
___
## 使用介绍
### 修改配置文件及相关代码
邮箱信息是用来推送打卡信息的，一定要换成自己的。以qq邮箱为例，请进入设置--账户--POP3/SMTP服务，请确保POP3/SMTP服务开启，然后获取授权码填在pass_后面。  
![图片](https://github.com/Leon-S-Kennedy/xpu_wzxy/blob/master/xpu_wzxy/img/img1.png "图片")  
账号信息一般为自己的手机号，密码是自己设置的，建议改成全小写英文的密码。执行脚本的时候建议从手机小程序端退出。（否则可能出现密码错误的情况，如果是这样建议修改密码--清除缓存--退出小程序--过一段时间再执行脚本）  
需要通过抓包软件获取自己的相关信息（如果不在乎设备的话可以忽略这步）。常见的抓包软件有fiddler以及Wireshark等，在手机上可以通过httpcanary等软件进行抓包。一般来说，使用手机进行抓包的时候会在健康打卡以及晚签到提交的时候出错（不过这就够了，`User_Agent`,`jwseeeion`,`Referer`等信息已经获取到了）。我们可以通过PC端小程序进行抓取,这样就可以获得提交的信息的请求头、请求体等关键内容，从而发送打卡或签到数据（基本没必要，已经写好了，直接使用即可，不放心可以自行抓取信息）。  
接下来就是经纬度等位置信息进行修改了。如果是晚签到的话，信息基本上不用修改（因为签到地点在学校内，基本不变，所以我将这个写死了，其他校区建议通过腾讯坐标拾取系统等进行调试），如果是健康打卡的话，其信息基本上也不怎么需要变动，如果需要变动，只需要修改配置文件中的经纬度信息，然后将健康打卡脚本中的`excute`函数的注释去掉即可。
### 使用crontab等实现后台自动执行
确保config.py中的信息填写完毕之后，建议先进性一段时间的测试和调整。如果没有问题接下来就可将代码部署到云服务上进行自动执行了  
crontab是linux上自带的用来执行定期程序的命令，一般来说当安装完成操作系统之后，默认便会启动此任务调度命令。（注意：这个服务是开机自启动的，不用用担心重启的问题）
#### crontab基本介绍
* 安装crontab `yum install crontabs`
* 查看crontab状态 `service crond status`
* 启动crontab服务 `service crond start`
* 停止crontab服务 `service crond stop`
* 重启crontab服务 `service crond restart`
* 重新载入crontab配置 `service crond reload`
* 查看定时任务 `crontab -l`
* 修改定时任务 `crontab -e`  
**crontab的具体用法可以在网上找到很多教程，此处不再介绍，仅演示其基本用法**
___
#### 使用演示
我们首先将修改好的脚本放入自己设定目录下。我们先看下crontab是否开启。输入`service crond status` 如果出现如下图的情况证明已经开启服务。
![图片](https://github.com/Leon-S-Kennedy/xpu_wzxy/blob/master/xpu_wzxy/img/img2.png "图片")  
接下来我们来输入`crontab -e`来进行定时任务的配置。该命令以vim的方式打卡了一个文件，我们只需要按照指定的格式写配置文件即可。我们按下<kbd>i</kbd>进入编辑模式，在文件后面添加两条指令  
* `30 12 * * * python3 /root/xpu_wzxy/save.py > /dev/null 2>&1 `  
* `30 21 * * * python3 /root/xpu_wzxy/doSign.py > /dev/null 2>&1 `  
这两条指令分别表示每天的12：30执行健康打卡脚本、每天的21：30执行晚签到脚本。编辑完成之后我们按<kbd>esc</kbd>退出编辑模式，然后按<kbd>:</kbd>输入`wq`保存配置文件即可。  
***到此,我们就可以愉快的完成本次任务了***
___
## 注意事项
1. **如果健康打卡的问题不一样，一定要记得修改`save.py`中的`save()`函数中的`saveData`字典中的`answers`列表的回答。因为该部分是固定的，所以我直接写死在了函数中，没有写进配置文件。**  
2. **如果出现密码错误的问题，我们需要修改小程序密码（建议全部英文小写字母）--清除缓存--退出小程序，保证自己没有在小程序上登录，然后过一段时间之后再执行脚本**
